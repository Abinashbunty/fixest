<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast Fixed-Effects Estimation: Short introduction • fixest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fast Fixed-Effects Estimation: Short introduction">
<meta property="og:description" content="fixest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fixest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/exporting_tables.html">Exporting estimation tables</a>
    </li>
    <li>
      <a href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short introduction</a>
    </li>
    <li>
      <a href="../articles/multiple_estimations.html">Multiple estimations</a>
    </li>
    <li>
      <a href="../articles/standard_errors.html">On standard-errors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrberge/fixest/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="fixest_walkthrough_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="fixest_walkthrough_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="fixest_walkthrough_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fast Fixed-Effects Estimation: Short introduction</h1>
                        <h4 class="author">Laurent Berge</h4>
            
            <h4 class="date">2020-12-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/master/vignettes/fixest_walkthrough.Rmd"><code>vignettes/fixest_walkthrough.Rmd</code></a></small>
      <div class="hidden name"><code>fixest_walkthrough.Rmd</code></div>

    </div>

    
    
<!-- Help on vignette writing here: http://r-pkgs.had.co.nz/vignettes.html. -->
<p>The package <code>fixest</code> provides a family of functions to perform estimations with multiple fixed-effects. The two main functions are <code>feols</code> for linear models and <code>feglm</code> for generalized linear models. In addition, the function <code>femlm</code> performs direct maximum likelihood estimation, and <code>feNmlm</code> extends the latter to allow the inclusion of non-linear in parameters right-hand-sides. Each of these functions supports any number of fixed-effects and is implemented with full fledged multi-threading in c++. Functions <code>feols</code> and <code>feglm</code> further support variables with varying slopes.</p>
<p>This package is currently (Feb. 2020) the fastest software available to perform fixed-effects estimations (see the project’s <a href="https://github.com/lrberge/fixest/">homepage</a> for a benchmarking).</p>
<p>The standard-errors of the estimates can be easily and intuitively clustered (up to four-way).</p>
<p>The function <code>etable</code> allows to seamlessly export the results of multiple estimations into either a data.frame, or into a Latex table.</p>
<p>The main features of the package are illustrated in this vignette. The theory used to obtain the fixed-effects is based on Berge (2018), “<em>Efficient estimation of maximum likelihood models with multiple fixed-effects: the R package FENmlm.</em>” CREA Discussion Papers, 13 (<a href="https://wwwen.uni.lu/content/download/110162/1299525/file/2018_13" class="uri">https://wwwen.uni.lu/content/download/110162/1299525/file/2018_13</a>).</p>
<div id="simple-example-using-trade-data" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-using-trade-data" class="anchor"></a>Simple example using trade data</h1>
<p>This example deals with international trade, which is a setup that usually requires performing estimations with many fixed-effects. We estimate a very simple gravity model in which we are interested in finding out the negative effect of geographic distance on trade. The sample data consists of European trade extracted from Eurostat. Let’s load the data contained in the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">fixest</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span></code></pre></div>
<p>This data is a sample of bilateral importations between EU15 countries from 2007 and 2016. The data is further broken down according to 20 product categories. Here is a sample of the data:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Destination</th>
<th align="left">Origin</th>
<th align="right">Product</th>
<th align="right">Year</th>
<th align="right">dist_km</th>
<th align="right">Euros</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">1</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">2966697</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">1</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">6755030</td>
</tr>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">2</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">57078782</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">2</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">7117406</td>
</tr>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">17379821</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">2622254</td>
</tr>
</tbody>
</table>
<p>The dependent variable of the estimation will be the level of trade between two countries while the independent variable is the geographic distance between the two countries. To obtain the elasticity of geographic distance net of the effects of the four fixed-effects, we estimate the following:</p>
<p><span class="math inline">\(E\left(Trade_{i,j,p,t}\right)=\gamma_{i}^{Exporter}\times\gamma_{j}^{Importer}\times\gamma_{p}^{Product}\times\gamma_{t}^{Year}\times Distance_{ij}^{\beta}\)</span>,</p>
<p>where the subscripts <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span>, <span class="math inline">\(p\)</span> and <span class="math inline">\(t\)</span> stand respectively for the exporting country, the importing country, the type of product and the year, and the <span class="math inline">\(\gamma_{v}^{c}\)</span> are fixed-effects for these groups. Here <span class="math inline">\(\beta\)</span> is the elasticity of interest.</p>
<p>Note that when you use the Poisson/Negative Binomial families, this relationship is in fact linear because the right hand side is exponentialized to avoid negative values for the Poisson parameter. This leads to the equivalent relation:<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p><span class="math inline">\(E\left(Trade_{i,j,p,t}\right)=\exp\left(\gamma_{i}^{Exporter}+\gamma_{j}^{Importer}+\gamma_{p}^{Product}+\gamma_{t}^{Year}+\beta\times \ln Distance_{ij}\right)\)</span>.</p>
<div id="estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation" class="anchor"></a>Estimation</h2>
<p>The estimation of this model using a Poisson likelihood is as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gravity_pois</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span></code></pre></div>
<p>The function <code>fepois</code> is actually an alias to the function <code>feglm</code> with <code>family = poisson</code>. The results can be shown directly with the <code>print</code> method:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gravity_pois</span><span class="op">)</span>
<span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span>
<span class="co">#&gt; Observations: 38,325 </span>
<span class="co">#&gt; Fixed-effects: Origin: 15,  Destination: 15,  Product: 20,  Year: 10</span>
<span class="co">#&gt; Standard-errors: Clustered (Origin) </span>
<span class="co">#&gt;              Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; log(dist_km)  -1.5279   0.115678 -13.208 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Log-Likelihood: -7.025e+11   Adj. Pseudo R2: 0.764032</span>
<span class="co">#&gt;            BIC:  1.405e+12     Squared Cor.: 0.612021</span></code></pre></div>
<p>The <code>print</code> reports the coefficient estimates and standard-errors as well as some other information. Among the quality of fit information, the squared-correlation corresponds to the correlation between the dependent variable and the expected predictor; it reflects somehow the idea of R-square in OLS estimations. Note that the estimation is performed using parallel computing which you can control using the argument <code>nthreads</code> (see the “multi-threading” section for more details).</p>
</div>
<div id="clustering-the-standard-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-the-standard-errors" class="anchor"></a>Clustering the standard-errors</h2>
<p>To cluster the standard-errors, we can simply use the argument <code>se</code> of the <code>summary</code> method. Let’s say we want to cluster the standard-errors according to the first two fixed-effects (i.e. the <em>Origin</em> and <em>Destination</em> variables). Then we just have to do:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, se <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span>
<span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span>
<span class="co">#&gt; Observations: 38,325 </span>
<span class="co">#&gt; Fixed-effects: Origin: 15,  Destination: 15,  Product: 20,  Year: 10</span>
<span class="co">#&gt; Standard-errors: Two-way (Origin &amp; Destination) </span>
<span class="co">#&gt;              Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; log(dist_km)  -1.5279   0.130734 -11.687 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Log-Likelihood: -7.025e+11   Adj. Pseudo R2: 0.764032</span>
<span class="co">#&gt;            BIC:  1.405e+12     Squared Cor.: 0.612021</span></code></pre></div>
<p>The clustering can be done on one (<code>se="cluster"</code>), two (<code>se="twoway"</code>), three (<code>se="threeway"</code>) or up to four (<code>se="fourway"</code>) variables. If the estimation includes fixed-effects, then by default the clustering will be done using these fixed-effects, in the original order. This is why the <em>Origin</em> and <em>Destination</em> variables were used for the two-way clustering in the previous example. If, instead, you wanted to perform one-way clustering on the <em>Product</em> variable, you need to use the argument <code>cluster</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Equivalent ways of clustering the SEs:</span>
<span class="co"># One-way clustering is deduced from the arguent 'cluster'</span>
<span class="co"># - using the vector:</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, cluster <span class="op">=</span> <span class="va">trade</span><span class="op">$</span><span class="va">Product</span><span class="op">)</span>
<span class="co"># - by reference:</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, cluster <span class="op">=</span> <span class="st">"Product"</span><span class="op">)</span>
<span class="co"># - with a formula:</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Product</span><span class="op">)</span></code></pre></div>
<p>All produce the same results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Product</span><span class="op">)</span>
<span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span>
<span class="co">#&gt; Observations: 38,325 </span>
<span class="co">#&gt; Fixed-effects: Origin: 15,  Destination: 15,  Product: 20,  Year: 10</span>
<span class="co">#&gt; Standard-errors: Clustered (Product) </span>
<span class="co">#&gt;              Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; log(dist_km)  -1.5279   0.098294 -15.544 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Log-Likelihood: -7.025e+11   Adj. Pseudo R2: 0.764032</span>
<span class="co">#&gt;            BIC:  1.405e+12     Squared Cor.: 0.612021</span></code></pre></div>
<p>Note that you can always cluster the standard-errors, even when the estimation contained no fixed-effect. But then you must use the argument <code>cluster</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gravity_simple</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span>, <span class="va">trade</span><span class="op">)</span>
<span class="co"># Two way clustering is deduced from the argument 'cluster'</span>
<span class="co"># Using data:</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity_simple</span>, cluster <span class="op">=</span> <span class="va">trade</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Origin"</span>, <span class="st">"Destination"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span>
<span class="co">#&gt; Observations: 38,325 </span>
<span class="co">#&gt; Standard-errors: Two-way (Origin &amp; Destination) </span>
<span class="co">#&gt;              Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)    24.709   1.124800 21.9680 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; log(dist_km)   -1.029   0.158022 -6.5114  7.44e-11 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Log-Likelihood: -2.426e+12   Adj. Pseudo R2: 0.185023</span>
<span class="co">#&gt;            BIC:  4.852e+12     Squared Cor.: 0.055107</span>
<span class="co"># Using a formula (note that the values of the variables are </span>
<span class="co">#  fetched directly in the original database):</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity_simple</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span><span class="op">)</span>
<span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span>
<span class="co">#&gt; Observations: 38,325 </span>
<span class="co">#&gt; Standard-errors: Two-way (Origin &amp; Destination) </span>
<span class="co">#&gt;              Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)    24.709   1.124800 21.9680 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; log(dist_km)   -1.029   0.158022 -6.5114  7.44e-11 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Log-Likelihood: -2.426e+12   Adj. Pseudo R2: 0.185023</span>
<span class="co">#&gt;            BIC:  4.852e+12     Squared Cor.: 0.055107</span></code></pre></div>
<p>Finally, the standard-errors can also be computed at estimation time, you simply need to add the <code>se</code> or <code>cluster</code> argument:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span>, <span class="va">trade</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Product</span><span class="op">)</span>
<span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span>
<span class="co">#&gt; Observations: 38,325 </span>
<span class="co">#&gt; Standard-errors: Clustered (Product) </span>
<span class="co">#&gt;              Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)    24.709   0.330044  74.865 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; log(dist_km)   -1.029   0.045954 -22.391 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Log-Likelihood: -2.426e+12   Adj. Pseudo R2: 0.185023</span>
<span class="co">#&gt;            BIC:  4.852e+12     Squared Cor.: 0.055107</span></code></pre></div>
</div>
<div id="other-estimation-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#other-estimation-functions" class="anchor"></a>Other estimation functions</h2>
<p>Now we estimate the same relationship by OLS. We need to put the left hand side in logarithm (since the right-hand-side is not exponentialized):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gravity_ols</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Euros</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span></code></pre></div>
<p>Of course you can use different families in <code>feglm</code>, exactly as in <code>glm</code>.</p>
<p>To get the estimation for the fixed-effects Negative Binomial:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gravity_negbin</span> <span class="op">=</span> <span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span></code></pre></div>
</div>
<div id="viewing-the-results-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#viewing-the-results-in-r" class="anchor"></a>Viewing the results in R</h2>
<p>Now let’s say that we want a compact overview of the results of several estimations. The best way is to use the function <code>etable</code>. This function summarizes the results of several <code>fixest</code> estimations into a data.frame. To see the fixed-effects results with the three different likelihoods, we just have to type:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">gravity_pois</span>, <span class="va">gravity_negbin</span>, <span class="va">gravity_ols</span>,
         se <span class="op">=</span> <span class="st">"twoway"</span>, subtitles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Poisson"</span>, <span class="st">"Negative Binomial"</span>, <span class="st">"Gaussian"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">gravity_pois</th>
<th align="left">gravity_negbin</th>
<th align="left">gravity_ols</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">Poisson</td>
<td align="left">Negative Binomial</td>
<td align="left">Gaussian</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">log(dist_km)</td>
<td align="left">-1.528*** (0.1307)</td>
<td align="left">-1.711*** (0.1773)</td>
<td align="left">-2.17*** (0.1714)</td>
</tr>
<tr class="even">
<td align="left">Fixed-Effects:</td>
<td align="left">——————</td>
<td align="left">——————</td>
<td align="left">—————–</td>
</tr>
<tr class="odd">
<td align="left">Origin</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">Destination</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">Product</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">Year</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">_______________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
<td align="left">_________________</td>
</tr>
<tr class="even">
<td align="left">Family</td>
<td align="left">Poisson</td>
<td align="left">Neg. Bin.</td>
<td align="left">OLS</td>
</tr>
<tr class="odd">
<td align="left">S.E.: Clustered</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
</tr>
<tr class="even">
<td align="left">Observations</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
</tr>
<tr class="odd">
<td align="left">Squared Cor.</td>
<td align="left">0.612021</td>
<td align="left">0.437605</td>
<td align="left">0.705577</td>
</tr>
<tr class="even">
<td align="left">Pseudo R2</td>
<td align="left">0.764032</td>
<td align="left">0.03473</td>
<td align="left">0.236404</td>
</tr>
<tr class="odd">
<td align="left">BIC</td>
<td align="left">1.405e+12</td>
<td align="left">1,293,786.09</td>
<td align="left">151,977.21</td>
</tr>
<tr class="even">
<td align="left">Over-dispersion</td>
<td align="left">–</td>
<td align="left">0.548774</td>
<td align="left">–</td>
</tr>
</tbody>
</table>
<p>We added the argument <code>se="twoway"</code> to cluster the standard-errors for all estimations. As can be seen this function gives an overview of the estimates and standard-errors, as well as some quality of fit measures. The argument <code>subtitles</code> is used to add information on each estimation column.</p>
<p>In the previous example, we directly added the estimation results as arguments of the function <code>etable</code>. But the function also accepts lists of estimations. Let’s give an example. Say you want to see the influence of the introduction of fixed-effects on the estimate of the elasticity of distance. You can do it with the following code where we use the argument <code>fixef</code> to include fixed-effects (instead of inserting them directly in the formula):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gravity_subfe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">all_FEs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Destination"</span>, <span class="st">"Origin"</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>
    <span class="va">gravity_subfe</span><span class="op">[[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span>, <span class="va">trade</span>, fixef <span class="op">=</span> <span class="va">all_FEs</span><span class="op">[</span><span class="fl">0</span><span class="op">:</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The previous code performs 4 estimations with an increasing number of fixed-effects and store their results into the list named <code>gravity_subfe</code>. To show the results of all 4 estimations, it’s easy:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">gravity_subfe</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="17%">
<col width="19%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">model 1</th>
<th align="left">model 2</th>
<th align="left">model 3</th>
<th align="left">model 4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Dependent Var.:</td>
<td align="left">Euros</td>
<td align="left">Euros</td>
<td align="left">Euros</td>
<td align="left">Euros</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="left">24.71*** (1.125)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">log(dist_km)</td>
<td align="left">-1.029*** (0.158)</td>
<td align="left">-1.029*** (0.1581)</td>
<td align="left">-1.226*** (0.2045)</td>
<td align="left">-1.518*** (0.1282)</td>
</tr>
<tr class="odd">
<td align="left">Fixed-Effects:</td>
<td align="left">—————–</td>
<td align="left">——————</td>
<td align="left">——————</td>
<td align="left">——————</td>
</tr>
<tr class="even">
<td align="left">Year</td>
<td align="left">No</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">Destination</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">Origin</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">_______________</td>
<td align="left">_________________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
</tr>
<tr class="even">
<td align="left">S.E.: Clustered</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
</tr>
<tr class="odd">
<td align="left">Observations</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
</tr>
<tr class="even">
<td align="left">Squared Cor.</td>
<td align="left">0.055107</td>
<td align="left">0.057114</td>
<td align="left">0.164195</td>
<td align="left">0.384786</td>
</tr>
<tr class="odd">
<td align="left">Pseudo R2</td>
<td align="left">0.185023</td>
<td align="left">0.188326</td>
<td align="left">0.358257</td>
<td align="left">0.593121</td>
</tr>
<tr class="even">
<td align="left">BIC</td>
<td align="left">4.852e+12</td>
<td align="left">4.833e+12</td>
<td align="left">3.821e+12</td>
<td align="left">2.423e+12</td>
</tr>
</tbody>
</table>
<p>We have a view of the 4 estimations, all reporting two-way clustered standard-errors thanks to the use of the argument <code>cluster</code>.</p>
</div>
<div id="multiple-estimations" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-estimations" class="anchor"></a>Multiple estimations</h2>
<p>Note that since version 0.8.0, multiple estimations can be performed at once without requiring loops. Let’s replicate the previous example using <code>fixest</code> stepwise functions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_multi</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="../reference/stepwise.html">csw0</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Destination</span>, <span class="va">Origin</span><span class="op">)</span>, <span class="va">trade</span><span class="op">)</span></code></pre></div>
<p>The previous line of code performs 4 estimations. The function <code>csw0</code> is the key here, it means: <em>cumulative stepwise starting with the empty element</em>. Starting with the empty element, each new estimation adds a new element in the <code><a href="../reference/stepwise.html">csw0()</a></code> function, quite like the previous loop. Then you can consider the results, here <code>res_multi</code>, as a list of results, although with specific methods to easily access each element.</p>
<p>Stepwise functions can be applied to the linear right-hand-side and to the fixed-effects, you can also have multiple dependent variables and perform split sample estimations with the argument <code>split</code>. All of this is detailed in the dedicated vignette: <a href="https://cran.r-project.org/package=fixest/vignettes/multiple_estimations.html">Multiple estimations</a>.</p>
</div>
<div id="exporting-the-results-to-latex" class="section level2">
<h2 class="hasAnchor">
<a href="#exporting-the-results-to-latex" class="anchor"></a>Exporting the results to Latex</h2>
<p>So far we have seen how to report the results of multiple estimations on the R console. Now, using the same function <code>etable</code>, we can also export the results to high quality Latex tables. We just need to provide the argument <code>tex = TRUE</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># with two-way clustered SEs</span>
<span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_multi</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span>, tex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; \begin{tabular}{lcccc}</span>
<span class="co">#&gt; \tabularnewline\midrule\midrule</span>
<span class="co">#&gt; Dependent Variable:&amp;\multicolumn{4}{c}{Euros}\\</span>
<span class="co">#&gt; Model:&amp;(1) &amp; (2) &amp; (3) &amp; (4)\\</span>
<span class="co">#&gt; \midrule \emph{Variables}&amp;   &amp;   &amp;   &amp;  \\</span>
<span class="co">#&gt; (Intercept)&amp;24.71$^{***}$ &amp;    &amp;    &amp;   \\</span>
<span class="co">#&gt;   &amp;(1.125) &amp;    &amp;    &amp;   \\</span>
<span class="co">#&gt; log(dist\_km)&amp;-1.029$^{***}$ &amp; -1.029$^{***}$ &amp; -1.226$^{***}$ &amp; -1.518$^{***}$\\</span>
<span class="co">#&gt;   &amp;(0.1580) &amp; (0.1581) &amp; (0.2045) &amp; (0.1282)\\</span>
<span class="co">#&gt; \midrule \emph{Fixed-effects}&amp;   &amp;   &amp;   &amp;  \\</span>
<span class="co">#&gt; Year &amp;  &amp; Yes &amp; Yes &amp; Yes\\</span>
<span class="co">#&gt; Destination &amp;  &amp;  &amp; Yes &amp; Yes\\</span>
<span class="co">#&gt; Origin &amp;  &amp;  &amp;  &amp; Yes\\</span>
<span class="co">#&gt; \midrule \emph{Fit statistics}&amp;  &amp; &amp; &amp; \\</span>
<span class="co">#&gt; Observations &amp; 38,325&amp;38,325&amp;38,325&amp;38,325\\</span>
<span class="co">#&gt; Squared Correlation &amp; 0.055107&amp;0.057114&amp;0.164195&amp;0.384786\\</span>
<span class="co">#&gt; Pseudo R$^2$ &amp; 0.185023&amp;0.188326&amp;0.358257&amp;0.593121\\</span>
<span class="co">#&gt; BIC &amp; $4.852\times 10^{12}$&amp;$4.833\times 10^{12}$&amp;$3.821\times 10^{12}$&amp;$2.423\times 10^{12}$\\</span>
<span class="co">#&gt; \midrule\midrule\multicolumn{5}{l}{\emph{Two-way (Origin \&amp; Destination) standard-errors in parentheses}}\\</span>
<span class="co">#&gt; \multicolumn{5}{l}{\emph{Signif. Codes: ***: 0.01, **: 0.05, *: 0.1}}\\</span>
<span class="co">#&gt; \end{tabular}</span></code></pre></div>
<p>The user can export the Latex table directly into a file (argument <code>file</code>), add a title (arg. <code>title</code>) and a label to the table (arg. <code>label</code>). Note that when the argument <code>file</code> is present, the Latex format becomes the default (i.e. <code>tex = TRUE</code> by default).</p>
<p>The coefficients can be renamed easily (arg. <code>dict</code>), some can be dropped (arg. <code>drop</code>) and they can be easily reordered with regular expressions (arg. <code>order</code>).</p>
<p>The significance codes can easily be changed (arg. <code>signifCode</code>) and all quality of fit information can be customized (argument <code>fitstat</code>). Among others, the number of fixed-effect per fixed-effect dimension can also be displayed using the argument <code>fixef_sizes</code>.</p>
<div id="an-elaborate-example" class="section level3">
<h3 class="hasAnchor">
<a href="#an-elaborate-example" class="anchor"></a>An elaborate example</h3>
<p>Consider the following example of the exportation of two tables:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we set the dictionary once and for all</span>
<span class="va">myDict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log(dist_km)"</span> <span class="op">=</span> <span class="st">"$\\ln (Distance)$"</span>, <span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="st">"Constant"</span><span class="op">)</span>
<span class="co"># 1st export: we change the signif code and drop the intercept</span>
<span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_multi</span>, signifCode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"b"</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,
       drop <span class="op">=</span> <span class="st">"Const"</span>, dict <span class="op">=</span> <span class="va">myDict</span>, file <span class="op">=</span> <span class="st">"Estimation Tables.tex"</span>, 
       replace <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"First export -- normal Standard-errors"</span><span class="op">)</span>
<span class="co"># 2nd export: clustered S-E + distance as the first coefficient</span>
<span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_multi</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Product</span>, order <span class="op">=</span> <span class="st">"Dist"</span>, 
       dict <span class="op">=</span> <span class="va">myDict</span>, file <span class="op">=</span> <span class="st">"Estimation Tables.tex"</span>, 
       title <span class="op">=</span> <span class="st">"Second export -- clustered standard-errors (on Product variable)"</span><span class="op">)</span></code></pre></div>
<p>In this example, two tables containing the results of the 4 estimations are directly exported to a Latex table into the file “Estimation Tables.tex”. First take notice (again) that <em>we do not need to use the argument</em> <code>tex=TRUE</code> since when the argument <code>file</code> is present, the Latex format becomes the default. The file is re-created in the first exportation thanks to the argument <code>replace = TRUE</code>.</p>
<p>To change the variable names in the Latex table, we use the argument <code>dict</code>. The variable <code>myDict</code> is the dictionary we use to rename the variables, it is simply a named vector. The original name of the variables correspond to the names of <code>myDict</code> while the new names of the variables are the values of this vector. Any variable that matches the names of <code>myDict</code> will be replaced by its value. Thus we do not care of the order of appearance of the variables in the estimation results.</p>
<p>In the first export, the coefficient of the intercept is dropped by using <code>drop = "Const"</code> (could be anything such that <code><a href="https://rdrr.io/r/base/grep.html">grepl(drop[1], "Constant")</a></code> is TRUE). In the second, the coefficient of the distance is put before the intercept (which is kept) thanks to the argument <code>order</code>. Note that the actions performed by the arguments <code>drop</code> or <code>order</code> are performed <strong>after</strong> the renaming takes place with the argument <code>dict</code>.</p>
<p>Note that you can completely customize the style of the table by using the <code>style</code> and <code>postprocessing</code> arguments, please have a look at the dedicated vignette: <a href="https://cran.r-project.org/package=fixest/vignettes/exporting_tables.html">Exporting estimation tables</a>.</p>
</div>
</div>
<div id="extracting-the-fixed-effects-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-the-fixed-effects-coefficients" class="anchor"></a>Extracting the fixed-effects coefficients</h2>
<p>To obtain the fixed-effects of the estimation, the function <code>fixef</code> must be performed on the results. This function returns a list containing the fixed-effects coefficients for each dimension. The <code>summary</code> method helps to have a quick overview:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fixedEffects</span> <span class="op">=</span> <span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">gravity_pois</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fixedEffects</span><span class="op">)</span>
<span class="co">#&gt; Fixed_effects coefficients</span>
<span class="co">#&gt;                         Origin Destination Product  Year</span>
<span class="co">#&gt; Number of fixed-effects     15          15      20    10</span>
<span class="co">#&gt; Number of references         0           1       1     1</span>
<span class="co">#&gt; Mean                      23.3        3.09  0.0129 0.157</span>
<span class="co">#&gt; Standard-deviation        1.28        1.11    1.36 0.113</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; COEFFICIENTS:</span>
<span class="co">#&gt;   Origin:    AT    BE    DE    DK    ES                 </span>
<span class="co">#&gt;           22.51 23.56 24.71 23.44 24.97 ... 10 remaining</span>
<span class="co">#&gt; -----</span>
<span class="co">#&gt;   Destination:    AT    BE    DE    DK    ES                 </span>
<span class="co">#&gt;                2.436 2.696 4.323 2.451 4.043 ... 10 remaining</span>
<span class="co">#&gt; -----</span>
<span class="co">#&gt;   Product: 1     2      3     4      5                 </span>
<span class="co">#&gt;            0 1.414 0.6562 1.449 -1.521 ... 15 remaining</span>
<span class="co">#&gt; -----</span>
<span class="co">#&gt;   Year: 2007    2008     2009    2010  2011                </span>
<span class="co">#&gt;            0 0.06912 0.005225 0.07331 0.163 ... 5 remaining</span></code></pre></div>
<p>We can see that the fixed-effects are balanced across the dimensions. Indeed, apart from the first dimension, only one coefficient per fixed-effect needs to be set as reference (i.e. fixed to 0) to avoid collinearity across the different fixed-effects dimensions. This ensures that the fixed-effects coefficients can be compared within a given fixed-effect dimension. Had there be strictly more than one reference per fixed-effect dimension, their interpretation would have not been possible at all. If this was the case though, a warning message would have been prompted. Note that the mean values are meaningless per se, but give a reference points to which compare the fixed-effects within a dimension. Let’s look specifically at the <code>Year</code> fixed-effects:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fixedEffects</span><span class="op">$</span><span class="va">Year</span>
<span class="co">#&gt;        2007        2008        2009        2010        2011        2012 </span>
<span class="co">#&gt; 0.000000000 0.069122284 0.005225473 0.073308208 0.163013386 0.192605170 </span>
<span class="co">#&gt;        2013        2014        2015        2016 </span>
<span class="co">#&gt; 0.230629376 0.242605404 0.282800683 0.310325692</span></code></pre></div>
<p>Finally, the <code>plot</code> method helps to distinguish the most notable fixed-effects:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fixedEffects</span><span class="op">)</span></code></pre></div>
<p><img src="fixest_walkthrough_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>For each dimension, the fixed-effects are first centered, then sorted, and finally the most notable (i.e. highest and lowest) are reported. The exponential of the coefficient is reported in the right hand side to simplify the interpretation for models with log-link (as the Poisson model). As we can see from the country of destination fixed-effects, trade involving France (FR), Italy (IT) and Germany (DE) as destination countries is more than 2.7 times higher than the EU15 average. Further, the highest heterogeneity come from the product category, where trade in product 4 (dairy products) is roughly 2.7 times the average while product 14 (vegetable plaiting materials) represents a negligible fraction of the average.</p>
<p>Note however that the interpretation of the fixed-effects must be taken with extra care. In particular, here the fixed-effects can be interpreted only because they are perfectly balanced.</p>
</div>
</div>
<div id="instrumental-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#instrumental-variables" class="anchor"></a>Instrumental variables</h1>
<p>Two stage least square estimations can be performed by simply adding in the formula the link between the endogenous and the instrumental variables. Let’s have an example.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">base</span> <span class="op">=</span> <span class="va">iris</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span>, <span class="st">"x_endo_1"</span>, <span class="st">"x_inst_1"</span>, <span class="st">"fe"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">base</span><span class="op">$</span><span class="va">x_inst_2</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">x_endo_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">150</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">base</span><span class="op">$</span><span class="va">x_endo_2</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">x_inst_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">150</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>

<span class="va">est_iv</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">x_endo_1</span> <span class="op">+</span> <span class="va">x_endo_2</span> <span class="op">~</span> <span class="va">x_inst_1</span> <span class="op">+</span> <span class="va">x_inst_2</span>, <span class="va">base</span><span class="op">)</span>
<span class="va">est_iv</span>
<span class="co">#&gt; TSLS estimation, Dep. Var.: y, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span>
<span class="co">#&gt; Second stage: Dep. Var.: y</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Standard-errors: Standard </span>
<span class="co">#&gt;              Estimate Std. Error t value  Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)  1.831400   0.411435  4.4512   1.7e-05 ***</span>
<span class="co">#&gt; fit_x_endo_1 0.444982   0.022086 20.1470 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; fit_x_endo_2 0.639916   0.307376  2.0819    0.0391 *  </span>
<span class="co">#&gt; x1           0.565095   0.084715  6.6705  4.92e-10 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.398842   Adj. R2: 0.761653</span>
<span class="co">#&gt; F-test (1st stage), x_endo_1: stat = 903.16  , p &lt; 2.2e-16 , on 2 and 146 DoF.</span>
<span class="co">#&gt; F-test (1st stage), x_endo_2: stat =   3.2583, p = 0.041268, on 2 and 146 DoF.</span>
<span class="co">#&gt;                   Wu-Hausman: stat =   6.7918, p = 0.001518, on 2 and 144 DoF.</span></code></pre></div>
<p>So we’ve just performed a two stage least squares estimation. The formula coming after the pipe, <code>x_endo_1 + x_endo_2 ~ x_inst_1 + x_inst_2</code>, describes the endogenous variables (on the left) and the instruments (on the right).</p>
<p>By default, three statistics are displayed: the F-test from the first stage (weak instrument test), the Wu-Hausman endogeneity test and the overidentifying restrictions (Sargan) test. Note that the Sargan statistic appears only when relevant (i.e. when # instr. &gt; # endo. vars., not the case here).</p>
<p>You can use the <code>fitstat</code> command to summon other kind of tests, notably Wald tests on the first/second stages:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fitstat.html">fitstat</a></span><span class="op">(</span><span class="va">est_iv</span>, <span class="op">~</span> <span class="va">ivf1</span> <span class="op">+</span> <span class="va">ivwald1</span> <span class="op">+</span> <span class="va">ivf2</span> <span class="op">+</span> <span class="va">ivwald2</span>, cluster <span class="op">=</span> <span class="st">"fe"</span><span class="op">)</span>
<span class="co">#&gt; F-test (1st stage), x_endo_1: stat =     903.16  , p &lt; 2.2e-16 , on 2 and 146 DoF.</span>
<span class="co">#&gt; F-test (1st stage), x_endo_2: stat =       3.2583, p = 0.041268, on 2 and 146 DoF.</span>
<span class="co">#&gt; Wald (1st stage), x_endo_1  : stat =   1,482.63  , p &lt; 2.2e-16 , on 2 and 146 DoF, VCOV matrix: Clustered (fe).</span>
<span class="co">#&gt; Wald (1st stage), x_endo_2  : stat =       2.2216, p = 0.112092, on 2 and 146 DoF, VCOV matrix: Clustered (fe).</span>
<span class="co">#&gt;           F-test (2nd stage): stat =     194.19  , p &lt; 2.2e-16 , on 2 and 146 DoF.</span>
<span class="co">#&gt;             Wald (2nd stage): stat = 539,363.18  , p &lt; 2.2e-16 , on 2 and 146 DoF, VCOV matrix: Clustered (fe).</span></code></pre></div>
<p>As the Wald test relies on a given variance-covariance matrix, you can pass extra arguments to <code>fitstat</code>, as the argument <code>cluster</code> in the previous example, to specify which type of VCOV matrix is desired.</p>
<p>Note that you can display the statistics that you wish when printing by changing the default print values:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/print.fixest.html">setFixest_print</a></span><span class="op">(</span>fitstat <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">ivwald2</span><span class="op">)</span>
<span class="va">est_iv</span>
<span class="co">#&gt; TSLS estimation, Dep. Var.: y, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span>
<span class="co">#&gt; Second stage: Dep. Var.: y</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Standard-errors: Standard </span>
<span class="co">#&gt;              Estimate Std. Error t value  Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)  1.831400   0.411435  4.4512   1.7e-05 ***</span>
<span class="co">#&gt; fit_x_endo_1 0.444982   0.022086 20.1470 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; fit_x_endo_2 0.639916   0.307376  2.0819    0.0391 *  </span>
<span class="co">#&gt; x1           0.565095   0.084715  6.6705  4.92e-10 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.398842   Adj. R2: 0.761653</span>
<span class="co">#&gt; F-test (1st stage), x_endo_1: stat = 903.16  , p &lt; 2.2e-16 , on 2 and 146 DoF.</span>
<span class="co">#&gt; F-test (1st stage), x_endo_2: stat =   3.2583, p = 0.041268, on 2 and 146 DoF.</span>
<span class="co">#&gt;                   Wu-Hausman: stat =   6.7918, p = 0.001518, on 2 and 144 DoF.</span>
<span class="co">#&gt;             Wald (2nd stage): stat = 224.03  , p &lt; 2.2e-16 , on 2 and 146 DoF, VCOV matrix: Standard.</span></code></pre></div>
<p>In the previous code, <code>fitstat = ~ . + ivwald2</code> means that we want to add the second stage Wald test to the existing printed statistics (represented here by the point).</p>
<p>Now what about adding some fixed-effects? That’s of course possible, you need to add them after the first right-hand-side, as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_iv_fe</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">fe</span> <span class="op">|</span> <span class="va">x_endo_1</span> <span class="op">+</span> <span class="va">x_endo_2</span> <span class="op">~</span> <span class="va">x_inst_1</span> <span class="op">+</span> <span class="va">x_inst_2</span>, <span class="va">base</span><span class="op">)</span>
<span class="va">est_iv_fe</span>
<span class="co">#&gt; TSLS estimation, Dep. Var.: y, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span>
<span class="co">#&gt; Second stage: Dep. Var.: y</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Fixed-effects: fe: 3</span>
<span class="co">#&gt; Standard-errors: Clustered (fe) </span>
<span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; fit_x_endo_1 0.666671   0.106558  6.2564 0.024608 *  </span>
<span class="co">#&gt; fit_x_endo_2 0.413839   0.177769  2.3280 0.145344    </span>
<span class="co">#&gt; x1           0.451680   0.153375  2.9449 0.098553 .  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.327938     Adj. R2: 0.836626</span>
<span class="co">#&gt;                  Within R2: 0.585907</span>
<span class="co">#&gt; F-test (1st stage), x_endo_1: stat = 21.28  , p = 7.969e-9, on 2 and 144 DoF.</span>
<span class="co">#&gt; F-test (1st stage), x_endo_2: stat =  4.7226, p = 0.010315, on 2 and 144 DoF.</span>
<span class="co">#&gt;                   Wu-Hausman: stat =  1.3141, p = 0.271968, on 2 and 142 DoF.</span>
<span class="co">#&gt;             Wald (2nd stage): stat = 19.57  , p = 3.02e-8 , on 2 and 144 DoF, VCOV matrix: Clustered (fe).</span></code></pre></div>
<p>To access the first stage(s), you can use the summary method:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">est_iv_fe</span>, stage <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; IV: First stage: x_endo_1</span>
<span class="co">#&gt; TSLS estimation, Dep. Var.: x_endo_1, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span>
<span class="co">#&gt; First stage: Dep. Var.: x_endo_1</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Fixed-effects: fe: 3</span>
<span class="co">#&gt; Standard-errors: Clustered (fe) </span>
<span class="co">#&gt;          Estimate Std. Error t value Pr(&gt;|t|) </span>
<span class="co">#&gt; x_inst_1 0.705992   0.485614  1.4538 0.283198 </span>
<span class="co">#&gt; x_inst_2 0.202337   0.143302  1.4120 0.293457 </span>
<span class="co">#&gt; x1       0.189320   0.135622  1.3959 0.297507 </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.346509     Adj. R2: 0.959865</span>
<span class="co">#&gt;                  Within R2: 0.338407</span>
<span class="co">#&gt; F-test (1st stage): stat = 21.28, p = 7.969e-9, on 2 and 144 DoF.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; IV: First stage: x_endo_2</span>
<span class="co">#&gt; TSLS estimation, Dep. Var.: x_endo_2, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span>
<span class="co">#&gt; First stage: Dep. Var.: x_endo_2</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Fixed-effects: fe: 3</span>
<span class="co">#&gt; Standard-errors: Clustered (fe) </span>
<span class="co">#&gt;           Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; x_inst_1 -0.546745   0.081370 -6.7192 0.021440 *  </span>
<span class="co">#&gt; x_inst_2  0.183092   0.083446  2.1942 0.159464    </span>
<span class="co">#&gt; x1        0.153198   0.089148  1.7185 0.227851    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.51208     Adj. R2: 0.040133</span>
<span class="co">#&gt;                 Within R2: 0.063919</span>
<span class="co">#&gt; F-test (1st stage): stat = 4.7226, p = 0.010315, on 2 and 144 DoF.</span></code></pre></div>
<p>When <code>summary</code> shall return more than one element, the object returned is not a regular <code>fixest</code> object but a <code>fixest_multi</code> object. These kind of objects are covered in the vignette: <a href="https://cran.r-project.org/package=fixest/vignettes/multiple_estimations.html">Multiple estimations</a>. You can display the first and second stages in a table with <code>etable</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">est_iv_fe</span>, stage <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, fitstat <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">ivfall</span> <span class="op">+</span> <span class="va">ivwaldall.p</span><span class="op">)</span>
<span class="co">#&gt;                                 model 1            model 2          model 3</span>
<span class="co">#&gt; Dependent Var.:                x_endo_1           x_endo_2                y</span>
<span class="co">#&gt;                                                                            </span>
<span class="co">#&gt; x_inst_1                 0.706 (0.4856) -0.5467* (0.08137)                 </span>
<span class="co">#&gt; x_inst_2                0.2023 (0.1433)   0.1831 (0.08345)                 </span>
<span class="co">#&gt; x1                      0.1893 (0.1356)   0.1532 (0.08915) 0.4517. (0.1534)</span>
<span class="co">#&gt; x_endo_1                                                   0.6667* (0.1066)</span>
<span class="co">#&gt; x_endo_2                                                    0.4138 (0.1778)</span>
<span class="co">#&gt; Fixed-Effects:          --------------- ------------------ ----------------</span>
<span class="co">#&gt; fe                                  Yes                Yes              Yes</span>
<span class="co">#&gt; _______________________ _______________ __________________ ________________</span>
<span class="co">#&gt; S.E.: Clustered                  by: fe             by: fe           by: fe</span>
<span class="co">#&gt; Observations                        150                150              150</span>
<span class="co">#&gt; R2                             0.961212           0.072344         0.842109</span>
<span class="co">#&gt; Within R2                      0.338407           0.063919         0.585907</span>
<span class="co">#&gt; F-test (IV only)                  21.28             4.7226            8.221</span>
<span class="co">#&gt; Wald (IV only), p-value        2.373e-9           1.373e-9          3.02e-8</span></code></pre></div>
<p>Here we use <code>stage = 1:2</code> to get all first stage regressions followed by the second stage. Using <code>stage = 2:1</code> would have done the opposite.</p>
<p>Now some explanations regarding <code>fitstat</code>. The suffix <code>all</code> concerns IV only and means the following: if it’s a first stage regression, then the first-stage F-stat is displayed, otherwise it’s the second stage F-stat. The suffix <code>.p</code> is used in <code>ivwaldall.p</code> to access the p-value and not the statistic. Finally, you can permanently set which fit statistic to display in <code>etable</code> by using <code>setFixest_etable</code>, like for example <code><a href="../reference/etable.html">setFixest_etable(fitstat = ~ . + ivfall + ivwaldall.p)</a></code>.</p>
</div>
<div id="additional-features" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-features" class="anchor"></a>Additional features</h1>
<p>Now we present some other features of the package:</p>
<ol style="list-style-type: decimal">
<li><p><a href="#varying-slopes">How to add variables with varying slopes</a>.</p></li>
<li><p><a href="#combining-several-fixed-effects">How to combine several fixed-effects</a>.</p></li>
<li><p><a href="#formula-macros">Formula macros</a>.</p></li>
<li><p><a href="#the-function-i-for-factors-and-interactions">The function <code>i()</code> to create factors and interactions</a>.</p></li>
<li><p><a href="#lagging-variables">How to add lead/lags</a>.</p></li>
<li><p><a href="#non-linear-in-parameters-example">Non-linear in parameter estimation</a>.</p></li>
<li><p><a href="#multi-threading">Parallelism</a>.</p></li>
</ol>
<!-- NOTE: you can't have ":" or "(" in titles to make links --><div id="varying-slopes" class="section level2">
<h2 class="hasAnchor">
<a href="#varying-slopes" class="anchor"></a>Varying slopes</h2>
<p>You can introduce variables with varying slopes directly in the fixed-effects part of the formula using square brackets. Let’s go through a simple example using <code>iris</code> data:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">base_vs</span> <span class="op">=</span> <span class="va">iris</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">base_vs</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="st">"species"</span><span class="op">)</span></code></pre></div>
<p>We want to estimate <code>x1</code> as a function of <code>x2</code> and the variable <code>x3</code> with slopes varying according to <code>species</code>. We also want the <code>species</code> fixed-effect. We just have to do:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_vs</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="va">x2</span> <span class="op">|</span> <span class="va">species</span><span class="op">[</span><span class="va">x3</span><span class="op">]</span>, <span class="va">base_vs</span><span class="op">)</span>
<span class="va">est_vs</span>
<span class="co">#&gt; OLS estimation, Dep. Var.: x1</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Fixed-effects: species: 3</span>
<span class="co">#&gt; Varying slopes: x3 (species: 3)</span>
<span class="co">#&gt; Standard-errors: Clustered (species) </span>
<span class="co">#&gt;    Estimate Std. Error t value Pr(&gt;|t|) </span>
<span class="co">#&gt; x2 0.450006   0.156193  2.8811 0.102315 </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.298706     Adj. R2: 0.863506</span>
<span class="co">#&gt;                  Within R2: 0.178944</span></code></pre></div>
<p>If you want to see the slopes for <code>x3</code>, just use the function <code>fixef</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">est_vs</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Fixed-effects/Slope coefficients</span>
<span class="co">#&gt;                                species x3 (slopes: species)</span>
<span class="co">#&gt; Number of fixed-effects/slopes       3                    3</span>
<span class="co">#&gt; Number of references                 0                    0</span>
<span class="co">#&gt; Mean                               1.7                0.639</span>
<span class="co">#&gt; Standard-deviation                1.32                0.262</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; COEFFICIENTS:</span>
<span class="co">#&gt;   species: setosa versicolor virginica</span>
<span class="co">#&gt;             2.926      1.879    0.3068</span>
<span class="co">#&gt; -----</span>
<span class="co">#&gt;   x3 (slopes: species): setosa versicolor virginica</span>
<span class="co">#&gt;                         0.3677     0.6598    0.8903</span></code></pre></div>
</div>
<div id="combining-several-fixed-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-several-fixed-effects" class="anchor"></a>Combining several fixed-effects</h2>
<p>Let’s use the data we created in the previous section, and add a new variable:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we create another "fixed-effect"</span>
<span class="va">base_vs</span><span class="op">$</span><span class="va">fe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">base_vs</span><span class="op">)</span>
<span class="co">#&gt;    x1  x2  x3  x4 species fe</span>
<span class="co">#&gt; 1 5.1 3.5 1.4 0.2  setosa  1</span>
<span class="co">#&gt; 2 4.9 3.0 1.4 0.2  setosa  2</span>
<span class="co">#&gt; 3 4.7 3.2 1.3 0.2  setosa  3</span>
<span class="co">#&gt; 4 4.6 3.1 1.5 0.2  setosa  4</span>
<span class="co">#&gt; 5 5.0 3.6 1.4 0.2  setosa  5</span>
<span class="co">#&gt; 6 5.4 3.9 1.7 0.4  setosa  1</span></code></pre></div>
<p>Say we want to “combine” the variable <code>species</code> with the variable <code>fe</code> and create a brand new fixed-effect variable. We can do it simply using <code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_comb</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="va">x2</span> <span class="op">|</span> <span class="va">species</span><span class="op">^</span><span class="va">fe</span>, <span class="va">base_vs</span><span class="op">)</span>
<span class="va">est_comb</span>
<span class="co">#&gt; OLS estimation, Dep. Var.: x1</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Fixed-effects: species^fe: 15</span>
<span class="co">#&gt; Standard-errors: Clustered (species^fe) </span>
<span class="co">#&gt;    Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; x2 0.782815   0.119465  6.5527  1.3e-05 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.406785     Adj. R2: 0.729861</span>
<span class="co">#&gt;                  Within R2: 0.280234</span></code></pre></div>
<p>The function <code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code> does the same as <code><a href="https://rdrr.io/r/base/paste.html">paste0(species, "_", fe)</a></code> but is more convenient (and faster for large data sets). You can still extract the fixed-effects the same way:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">est_comb</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt;     setosa_1     setosa_2     setosa_3     setosa_4     setosa_5 versicolor_1 </span>
<span class="co">#&gt;     2.443630     2.384084     2.164943     2.296256     2.323630     3.713320 </span>
<span class="co">#&gt; versicolor_2 versicolor_3 versicolor_4 versicolor_5  virginica_1  virginica_2 </span>
<span class="co">#&gt;     3.800694     4.003367     3.745539     3.575086     4.513272     3.986351 </span>
<span class="co">#&gt;  virginica_3  virginica_4  virginica_5 </span>
<span class="co">#&gt;     4.423725     4.216804     4.159382</span></code></pre></div>
</div>
<div id="formula-macros" class="section level2">
<h2 class="hasAnchor">
<a href="#formula-macros" class="anchor"></a>Formula macros</h2>
<p>It can be useful, to tidy up the workflow or simply for convenience, to define formula macros: i.e. macro variables each representing several variables. This package offers two functions to deal with that: <code>setFixest_fml</code> to set macro variables globally, and <code>xpd</code> to create a formula with macro variables either globally defined or defined at run time.</p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">base</span> <span class="op">=</span> <span class="va">iris</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"species"</span><span class="op">)</span>
<span class="co"># Defining the macro variables</span>
<span class="fu"><a href="../reference/setFixest_fml.html">setFixest_fml</a></span><span class="op">(</span>..ctrl <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x2</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Accessing them</span>
<span class="fu"><a href="../reference/xpd.html">xpd</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">..ctrl</span><span class="op">)</span>
<span class="co">#&gt; y ~ x1 + poly(x2, 2) + poly(x3, 2)</span>
<span class="co">#&gt; &lt;environment: 0x0000000020272100&gt;</span>

<span class="co"># Definition at run time</span>
<span class="va">vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x2"</span>, <span class="st">"x2^2"</span>, <span class="st">"x3"</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/xpd.html">xpd</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">..ctrl</span>, ..ctrl <span class="op">=</span> <span class="va">vars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; y ~ x1 + x2</span>
<span class="co">#&gt; &lt;environment: 0x000000001fd76f78&gt;</span>
<span class="co">#&gt; y ~ x1 + x2 + x2^2</span>
<span class="co">#&gt; &lt;environment: 0x000000001fdb0a10&gt;</span>
<span class="co">#&gt; y ~ x1 + x2 + x2^2 + x3</span>
<span class="co">#&gt; &lt;environment: 0x000000001fdec230&gt;</span></code></pre></div>
<p>Macro variables must start with two dots. As seen in the example, once set globally they can be directly accessed with <code>xpd</code>. In the example, <code>xpd</code> redefines the formula at run-time by having a character vector as input.</p>
<p>All <code>fixest</code> estimations call <code>xpd</code> internally if appropriate. This means that the following code works just fine:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">..ctrl</span>, <span class="va">base</span><span class="op">)</span>
<span class="co">#&gt; OLS estimation, Dep. Var.: y</span>
<span class="co">#&gt; Observations: 150 </span>
<span class="co">#&gt; Standard-errors: Standard </span>
<span class="co">#&gt;               Estimate Std. Error t value  Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   4.122800   0.233398 17.6640 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; x1            0.562757   0.075897  7.4147  9.59e-12 ***</span>
<span class="co">#&gt; poly(x2, 2)1 12.601000   1.783000  7.0676  6.26e-11 ***</span>
<span class="co">#&gt; poly(x2, 2)2  1.635600   0.589023  2.7767  0.006222 ** </span>
<span class="co">#&gt; poly(x3, 2)1 -2.757000   1.725000 -1.5983  0.112171    </span>
<span class="co">#&gt; poly(x3, 2)2 -1.055600   0.668027 -1.5801  0.116273    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 0.30128   Adj. R2: 0.862108</span></code></pre></div>
<p>The function <code>xpd</code> also accepts regular expression macros of the form <code>..("regex")</code>. If these macros are encountered and provided a character vector/data.frame is in the argument <code>data</code>, then all variables names matching the regular expression will be placed in the formula.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">longley</span><span class="op">)</span>
<span class="fu"><a href="../reference/xpd.html">xpd</a></span><span class="op">(</span><span class="va">Armed.Forces</span> <span class="op">~</span> <span class="va">Population</span> <span class="op">+</span> <span class="fu">..</span><span class="op">(</span><span class="st">"GNP|ployed"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">longley</span><span class="op">)</span>
<span class="co">#&gt; Armed.Forces ~ Population + GNP.deflator + GNP + Unemployed + </span>
<span class="co">#&gt;     Employed</span>
<span class="co">#&gt; &lt;environment: 0x00000000215e4848&gt;</span></code></pre></div>
<p>Again, since <code>xpd</code> is called internally, the following works:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Armed.Forces</span> <span class="op">~</span> <span class="va">Population</span> <span class="op">+</span> <span class="fu">..</span><span class="op">(</span><span class="st">"GNP|ployed"</span><span class="op">)</span>, <span class="va">longley</span><span class="op">)</span>
<span class="co">#&gt; OLS estimation, Dep. Var.: Armed.Forces</span>
<span class="co">#&gt; Observations: 16 </span>
<span class="co">#&gt; Standard-errors: Standard </span>
<span class="co">#&gt;                 Estimate  Std. Error   t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)  4403.700000 4091.800000  1.076200 0.307112    </span>
<span class="co">#&gt; Population    -22.844000   32.671000 -0.699217 0.500356    </span>
<span class="co">#&gt; GNP.deflator    7.638500   12.348000  0.618611 0.550003    </span>
<span class="co">#&gt; GNP             3.150500    3.554200  0.886433 0.396201    </span>
<span class="co">#&gt; Unemployed     -0.591649    0.389005 -1.520900 0.159248    </span>
<span class="co">#&gt; Employed      -50.060000   25.348000 -1.974900 0.076522 .  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 36.10   Adj. R2: 0.569345</span></code></pre></div>
</div>
<div id="the-function-i-for-factors-and-interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#the-function-i-for-factors-and-interactions" class="anchor"></a>The function i for factors and interactions</h2>
<p>The function <code><a href="../reference/i.html">i()</a></code> is a versatile function allowing either: to consider a variable as a factor, with the possibility to easily keep/drop levels, or to create an interaction between a variable and another one treated as a factor.</p>
<p>As opposed to the <code>R</code> function <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, <code><a href="../reference/i.html">i()</a></code> has synergies with the other functions of the package: namely <code>etable</code> and <code>coefplot</code>. We now illustrate the two main uses of that function in turn.</p>
<div id="a-compact-syntax-for-factors" class="section level3">
<h3 class="hasAnchor">
<a href="#a-compact-syntax-for-factors" class="anchor"></a>A compact syntax for factors</h3>
<p>The function <code>i</code> accepts the arguments <code>ref</code>, <code>drop</code> and <code>keep</code>, the three are used to identify which level to keep. Note that the argument <code>ref</code> accepts only one value while <code>drop</code> accepts several. Here’s an example how to use them:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>
<span class="va">res_i1</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">Month</span><span class="op">)</span>, <span class="va">airquality</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).</span>
<span class="va">res_i2</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">Month</span>, ref <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, <span class="va">airquality</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).</span>
<span class="va">res_i3</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">Month</span>, keep <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="va">airquality</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).</span>

<span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_i1</span>, <span class="va">res_i2</span>, <span class="va">res_i3</span>, dict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"6"</span> <span class="op">=</span> <span class="st">"June"</span>, <span class="st">"Month::5"</span> <span class="op">=</span> <span class="st">"May"</span><span class="op">)</span>, 
       order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Int|May"</span>, <span class="st">"Mon"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                           res_i1            res_i2              res_i3</span>
<span class="co">#&gt; Dependent Var.:            Ozone             Ozone               Ozone</span>
<span class="co">#&gt;                                                                       </span>
<span class="co">#&gt; (Intercept)        3.219 (7.919)  40.12*** (7.828)    25.82*** (6.681)</span>
<span class="co">#&gt; May                               -36.9*** (8.201)    -24.5*** (6.936)</span>
<span class="co">#&gt; Month = June       5.069 (10.98)  -31.83** (11.05)     -19.46. (10.46)</span>
<span class="co">#&gt; Month = 7       31.04*** (8.018)    -5.861 (8.146)                    </span>
<span class="co">#&gt; Month = 8        36.9*** (8.201)                                      </span>
<span class="co">#&gt; Month = 9          8.912 (7.763) -27.99*** (7.845)                    </span>
<span class="co">#&gt; Solar.R         0.1148*** (0.03)  0.1148*** (0.03) 0.1253*** (0.03108)</span>
<span class="co">#&gt; _______________ ________________ _________________ ___________________</span>
<span class="co">#&gt; S.E. type               Standard          Standard            Standard</span>
<span class="co">#&gt; Observations                 111               111                 111</span>
<span class="co">#&gt; R2                      0.319741          0.319741            0.224521</span>
<span class="co">#&gt; Adj. R2                 0.287347          0.287347            0.202778</span></code></pre></div>
</div>
<div id="estimating-yearly-treatment-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-yearly-treatment-effects" class="anchor"></a>Estimating yearly treatment effects</h3>
<p>To illustrate interactions, we will estimate yearly treatment effects in a difference-in-difference setup.</p>
<p>Consider the the following data base where some persons (identified with the variable <code>id</code>) receive a treatment and others not, represented by the variable <code>treat</code>. The treatment takes effect from <code>period</code> 6 onward. The data looks like this:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sample data illustrating the DiD</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span>
<span class="co">#&gt;             y         x1 id period post treat</span>
<span class="co">#&gt; 1  2.87530627  0.5365377  1      1    0     1</span>
<span class="co">#&gt; 2  1.86065272 -3.0431894  1      2    0     1</span>
<span class="co">#&gt; 3  0.09416524  5.5768439  1      3    0     1</span>
<span class="co">#&gt; 4  3.78147485 -2.8300587  1      4    0     1</span>
<span class="co">#&gt; 5 -2.55819959 -5.0443544  1      5    0     1</span>
<span class="co">#&gt; 6  1.72873240 -0.6363849  1      6    1     1</span></code></pre></div>
<p>Using a two way fixed-effect setup, to create a variable capturing the yearly treatment effect we use <code><a href="../reference/i.html">i(treat, period, 5)</a></code> which corresponds to interacting the variable <code>treat</code> to a dummy variable for each <code>period</code>, and excluding period 5 (the syntax is <code><a href="../reference/i.html">i(var, f, ref)</a></code>). Note that, although the reference is optional, we need it otherwise there is a collinearity problem because of the fixed-effect <code>id</code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estimation of yearly treatment effect</span>
<span class="co"># We also add individual/time fixed-effects:</span>
<span class="va">est_did</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">period</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, <span class="va">base_did</span><span class="op">)</span>
<span class="va">est_did</span>
<span class="co">#&gt; OLS estimation, Dep. Var.: y</span>
<span class="co">#&gt; Observations: 1,080 </span>
<span class="co">#&gt; Fixed-effects: id: 108,  period: 10</span>
<span class="co">#&gt; Standard-errors: Clustered (id) </span>
<span class="co">#&gt;                   Estimate Std. Error   t value  Pr(&gt;|t|)    </span>
<span class="co">#&gt; x1                0.973490   0.045678 21.312000 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; treat:period::1  -1.403000   1.110300 -1.263700  0.209084    </span>
<span class="co">#&gt; treat:period::2  -1.247500   1.093100 -1.141200  0.256329    </span>
<span class="co">#&gt; treat:period::3  -0.273206   1.106900 -0.246813  0.805526    </span>
<span class="co">#&gt; treat:period::4  -1.795700   1.088000 -1.650500  0.101769    </span>
<span class="co">#&gt; treat:period::6   0.784452   1.028400  0.762798  0.447262    </span>
<span class="co">#&gt; treat:period::7   3.598900   1.101600  3.267100  0.001461 ** </span>
<span class="co">#&gt; treat:period::8   3.811800   1.247500  3.055500  0.002837 ** </span>
<span class="co">#&gt; treat:period::9   4.731400   1.097100  4.312600   3.6e-05 ***</span>
<span class="co">#&gt; treat:period::10  6.606200   1.120500  5.895800   4.4e-08 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; RMSE: 3.8365     Adj. R2: 0.48783 </span>
<span class="co">#&gt;                Within R2: 0.389628</span></code></pre></div>
<p>Now to display the yearly treatment effects on a graph, we can use the function <code>coefplot</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/coefplot.html">coefplot</a></span><span class="op">(</span><span class="va">est_did</span><span class="op">)</span></code></pre></div>
<p><img src="fixest_walkthrough_files/figure-html/unnamed-chunk-42-1.png" width="672"></p>
<p>The function <code>coefplot</code> detects that the results contain interactions and plot the appropriate graph. In case you wanted to display al the coefficients, including <code>x1</code>, you can use the argument <code>only.inter = FALSE</code>.</p>
</div>
</div>
<div id="lagging-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#lagging-variables" class="anchor"></a>Lagging variables</h2>
<p>Some methods have been created to easily deal with leads and lags in a panel setting. First is shown the various ways of how to deal with it in a <code>fixest</code> estimation, then how to create a panel data set, last is described a general way to create lead and lag variables.</p>
<div id="lagging-variables-in-an-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#lagging-variables-in-an-estimation" class="anchor"></a>Lagging variables in an estimation</h3>
<p>There are two ways to provide leads and/or lags in a <code>fixest</code> estimation. Either “on-the-fly” by using the argument <code>panel.id</code>, either by setting up a panel data set with the function <code>panel</code> (useful if you run multiple models needing lags and/or leads), described in the next subsection.</p>
<p>To set up the panel on-the-fly, you need to use the <code>panel.id</code> argument, which will give you access to the functions <code>f</code> and <code>l</code> to create leads and lags, respectively. Let’s give an example, using the previous data set, where we use lags and leads of the explanatory and dependent variables.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est1</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 108 observations removed because of NA values (RHS: 108).</span>
<span class="va">est2</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span>
<span class="va">est3</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 324 observations removed because of NA values (LHS: 108, RHS: 324).</span>
<span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est1</span>, <span class="va">est2</span>, <span class="va">est3</span>, order <span class="op">=</span> <span class="st">"f"</span>, drop <span class="op">=</span> <span class="st">"Int"</span><span class="op">)</span>
<span class="co">#&gt;                                est1               est2                est3</span>
<span class="co">#&gt; Dependent Var.:                   y             f(y,1)              l(y,1)</span>
<span class="co">#&gt;                                                                           </span>
<span class="co">#&gt; f(x1,1)                             0.994*** (0.05786)                    </span>
<span class="co">#&gt; x1              0.9948*** (0.05315)  0.008072 (0.0584)  -0.05338 (0.05991)</span>
<span class="co">#&gt; l(x1,1)           0.04096 (0.05401)  0.01569 (0.05854) 0.9871*** (0.06134)</span>
<span class="co">#&gt; l(x1,2)                                                  0.02201 (0.06075)</span>
<span class="co">#&gt; l(x1,3)                                                   0.0102 (0.05982)</span>
<span class="co">#&gt; _______________ ___________________ __________________ ___________________</span>
<span class="co">#&gt; S.E. type                  Standard           Standard            Standard</span>
<span class="co">#&gt; Observations                    972                864                 756</span>
<span class="co">#&gt; R2                          0.26558           0.256969            0.258748</span>
<span class="co">#&gt; Adj. R2                    0.264064           0.254377            0.254799</span></code></pre></div>
<p>First of all, the value of <code>panel.id</code> corresponds to panel identifiers: first comes the variable identifying the panel-individuals, then comes the variables identifying the time. In the example, the <code>panel.id</code> came in the form of a one-sided formula, but it could equivalently be equal to <code>panel.id = c("id", "period")</code> or <code>panel.id = "id,period"</code>.</p>
<p>As we can see, in the first estimation, a lag is created with the function <code>l</code>. The second argument of the function consists of a vector giving the lags we want. In this case, <code><a href="../reference/f.html">l(x1, 0:1)</a></code> means we want <code>x1</code> and the first lag of <code>x1</code>. This argument accepts negative values which give leads, as shown in the second estimation where <code><a href="../reference/f.html">l(x1, -1:1)</a></code> means that we want the first lead of <code>x1</code>, <code>x1</code>, then its first lag. In this example, we also use the first lead of <code>y</code> as a dependent variable with <code><a href="../reference/f.html">f(y)</a></code>.</p>
</div>
<div id="setting-up-a-panel-data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-a-panel-data-set" class="anchor"></a>Setting up a panel data set</h3>
<p>You can set up a panel data set with the function <code>panel</code>. There are between two and three advantages of doing so. First, if you have to estimate many models with leads and/or lags, setting up a panel gives you access to the lagging functions, <code>f</code> and <code>l</code>, without having to provide the <code>panel.id</code> argument we’ve seen in the previous subsection. Second, even when you estimate models with a sub-selection of the panel data, the data set is still a proper panel, meaning you can still use the lagging functions. Finally, and only if you are a <code>data.table</code> user, you can use the lagging functions to create new variables.</p>
<p>Let’s repeat the previous example, now with a panel data set:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># setting up the panel</span>
<span class="va">pdat</span> <span class="op">=</span> <span class="fu"><a href="../reference/panel.html">panel</a></span><span class="op">(</span><span class="va">base_did</span>, <span class="op">~</span><span class="va">id</span> <span class="op">+</span> <span class="va">period</span><span class="op">)</span>
<span class="co"># Now the panel.id argument is not required</span>
<span class="va">est1</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 108 observations removed because of NA values (RHS: 108).</span>
<span class="va">est2</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span>
<span class="co"># You can use sub selections of the panel data</span>
<span class="va">est_sub</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">[</span><span class="op">!</span><span class="va">pdat</span><span class="op">$</span><span class="va">period</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; NOTE: 324 observations removed because of NA values (RHS: 324).</span>
<span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est1</span>, <span class="va">est2</span>, <span class="va">est_sub</span>, order <span class="op">=</span> <span class="st">"f"</span>, drop <span class="op">=</span> <span class="st">"Int"</span><span class="op">)</span>
<span class="co">#&gt;                                est1               est2             est_sub</span>
<span class="co">#&gt; Dependent Var.:                   y             f(y,1)                   y</span>
<span class="co">#&gt;                                                                           </span>
<span class="co">#&gt; f(x1,1)                             0.994*** (0.05786)                    </span>
<span class="co">#&gt; x1              0.9948*** (0.05315)  0.008072 (0.0584)  1.013*** (0.07326)</span>
<span class="co">#&gt; l(x1,1)           0.04096 (0.05401)  0.01569 (0.05854) -0.006268 (0.07624)</span>
<span class="co">#&gt; _______________ ___________________ __________________ ___________________</span>
<span class="co">#&gt; S.E. type                  Standard           Standard            Standard</span>
<span class="co">#&gt; Observations                    972                864                 540</span>
<span class="co">#&gt; R2                          0.26558           0.256969            0.262581</span>
<span class="co">#&gt; Adj. R2                    0.264064           0.254377            0.259834</span></code></pre></div>
<p>Last, if you also use <code>data.table</code>, let’s give an example of lead/lag creation:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="va">pdat_dt</span> <span class="op">=</span> <span class="fu"><a href="../reference/panel.html">panel</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span>, <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span>
<span class="co"># we create a lagged value of the variable x1</span>
<span class="va">pdat_dt</span><span class="op">[</span>, <span class="va">x1_l1</span> <span class="op">:=</span> <span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co"># Now </span>
<span class="va">pdat_dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1_l1_fill0"</span>, <span class="st">"y_f2"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="../reference/f.html">l</a></span><span class="op">(</span><span class="va">x1</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="../reference/f.html">f</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pdat_dt</span><span class="op">)</span>
<span class="co">#&gt;              y         x1 id period post treat      x1_l1 x1_l1_fill0</span>
<span class="co">#&gt; 1:  2.87530627  0.5365377  1      1    0     1         NA   0.0000000</span>
<span class="co">#&gt; 2:  1.86065272 -3.0431894  1      2    0     1  0.5365377   0.5365377</span>
<span class="co">#&gt; 3:  0.09416524  5.5768439  1      3    0     1 -3.0431894  -3.0431894</span>
<span class="co">#&gt; 4:  3.78147485 -2.8300587  1      4    0     1  5.5768439   5.5768439</span>
<span class="co">#&gt; 5: -2.55819959 -5.0443544  1      5    0     1 -2.8300587  -2.8300587</span>
<span class="co">#&gt; 6:  1.72873240 -0.6363849  1      6    1     1 -5.0443544  -5.0443544</span>
<span class="co">#&gt;           y_f2</span>
<span class="co">#&gt; 1:  0.09416524</span>
<span class="co">#&gt; 2:  3.78147485</span>
<span class="co">#&gt; 3: -2.55819959</span>
<span class="co">#&gt; 4:  1.72873240</span>
<span class="co">#&gt; 5:  6.28423629</span>
<span class="co">#&gt; 6:  4.76688778</span></code></pre></div>
</div>
<div id="creating-laglead-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-laglead-variables" class="anchor"></a>Creating lag/lead variables</h3>
<p>If you just want to create a single lag/lead variable, a simple and fast method has been implemented: <code>lag.formula</code>. Let’s give an example:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">base_lag</span> <span class="op">=</span> <span class="va">base_did</span>
<span class="co"># we create a lagged value of the variable x1</span>
<span class="va">base_lag</span><span class="op">$</span><span class="va">x1.l1</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html">lag</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, <span class="fl">1</span>, <span class="va">base_lag</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">base_lag</span><span class="op">)</span>
<span class="co">#&gt;             y         x1 id period post treat      x1.l1</span>
<span class="co">#&gt; 1  2.87530627  0.5365377  1      1    0     1         NA</span>
<span class="co">#&gt; 2  1.86065272 -3.0431894  1      2    0     1  0.5365377</span>
<span class="co">#&gt; 3  0.09416524  5.5768439  1      3    0     1 -3.0431894</span>
<span class="co">#&gt; 4  3.78147485 -2.8300587  1      4    0     1  5.5768439</span>
<span class="co">#&gt; 5 -2.55819959 -5.0443544  1      5    0     1 -2.8300587</span>
<span class="co">#&gt; 6  1.72873240 -0.6363849  1      6    1     1 -5.0443544</span></code></pre></div>
<p>The first two arguments are mandatory. The formula informs on the variable to be lagged (on the left hand side), and the two panel identifiers. Note that the time index <strong>must</strong> appear second. The second argument tells how much lags we want. Using negative values gives leads. Finally the last argument informs on where to find the variables.</p>
<p>In case you use the popular package <code>data.table</code>, you can create lagged variables very simply:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="va">base_lag_dt</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span>
<span class="co"># we create a lagged value of the variable x1</span>
<span class="va">base_lag_dt</span><span class="op">[</span>, <span class="va">x1.l1</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html">lag</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></code></pre></div>
</div>
</div>
<div id="non-linear-in-parameters-example" class="section level2">
<h2 class="hasAnchor">
<a href="#non-linear-in-parameters-example" class="anchor"></a>Non-linear in parameters example</h2>
<p>The function <code>feNmlm</code> is similar to <code>femlm</code> but allows to have non-linear in parameters right-hand-sides (RHS). First an example without fixed-effects, the one with fixed-effects is given later. Let’s say we want to estimate the following relation with a Poisson model:</p>
<p><span class="math inline">\(E\left(z_i\right) = a\times x_i + b\times y_i\)</span>.</p>
<p>In fact, this type of model is non-linear in the context of a Poisson model because the sum is embedded within the log:</p>
<p><span class="math inline">\(E\left(z_i\right) = \exp\left(\log\left(a\times x_i + b\times y_i\right)\right)\)</span>.</p>
<p>So let’s estimate such a relation. (Note that you can estimate this relation with GLM and identity link, but I carry on for the example.) First we generate the data:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generating data:</span>
<span class="va">n</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="co"># x and y: two positive random variables</span>
<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span>
<span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span>
<span class="co"># E(z) = 2*x + 3*y and some noise</span>
<span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span></code></pre></div>
<p>To estimate the non-linear relationship, we need to use the argument <code>NL.fml</code> where we put the non-linear part. We also have to provide starting values with the argument <code>NL.start</code>. Finally, to ensure the RHS can be evaluated in any situation, we add lower bounds for the parameters with the argument <code>lower</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result_NL</span> <span class="op">=</span> <span class="fu"><a href="../reference/feNmlm.html">feNmlm</a></span><span class="op">(</span><span class="va">z</span><span class="op">~</span><span class="fl">0</span>, <span class="va">base</span>, NL.fml <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">b</span><span class="op">*</span><span class="va">y</span><span class="op">)</span>, NL.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">1</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that the arguments <code>NL.start</code> and <code>lower</code> are named lists. Setting <code>lower = list(a=0, b=0)</code> means that the optimization algorithm will never explore parameters for <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> that are lower than 0. The results obtained can be interpreted similarly to results with linear RHS. We can see them with a print:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">result_NL</span><span class="op">)</span>
<span class="co">#&gt; Non-linear ML estimation, family = Poisson, Dep. Var.: z</span>
<span class="co">#&gt; Observations: 1,000 </span>
<span class="co">#&gt; Standard-errors: Standard </span>
<span class="co">#&gt;   Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; a   2.0233   0.011217  180.38 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; b   3.0282   0.012684  238.74 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; Log-Likelihood: -3,596.84   Adj. Pseudo R2: 0.942674</span>
<span class="co">#&gt;            BIC:  7,207.51     Squared Cor.: 0.993353</span></code></pre></div>
<p>We can see that we obtain coefficients close to the generating values.</p>
<div id="adding-fixed-effects-to-non-linear-in-parameters-models" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-fixed-effects-to-non-linear-in-parameters-models" class="anchor"></a>Adding fixed-effects to non-linear in parameters models</h3>
<p>Adding fixed-effects is identical to the linear case. The user must only be well aware of the functional form. Indeed, the fixed-effects must enter the estimation <strong>linearly</strong>. This means that the previous equation with one set of fixed-effects writes:</p>
<p><span class="math inline">\(E\left(z_i\right) = \gamma_{id_i} \left( a\times x_i + b\times y_i \right)\)</span>,</p>
<p>where <span class="math inline">\(id_i\)</span> is the class of observation <span class="math inline">\(i\)</span> and <span class="math inline">\(\gamma\)</span> is the vector of fixed-effects. Here the fixed-effects are in fact linear because in the context of the Poisson model we estimate:</p>
<p><span class="math inline">\(E\left(z_i\right) = \exp\left(\gamma_{id_i}+\log\left(a\times x_i + b\times y_i\right)\right)\)</span>.</p>
<p>Further, remark that there exists an infinity of values of <span class="math inline">\(\gamma^{\prime}\)</span>, <span class="math inline">\(a^{\prime}\)</span> and <span class="math inline">\(b^{\prime}\)</span> such that:</p>
<p><span class="math inline">\(\gamma_{k} \left( a\times x_i + b\times y_i \right) = \gamma_{k}^{\prime} \left(a^{\prime}\times x_i + b^{\prime}\times y_i \right),\forall i,k\)</span>.</p>
<p>An example is <span class="math inline">\(\gamma^{\prime}_{k} = 2\times \gamma_k\)</span>, <span class="math inline">\(a^{\prime} = a/2\)</span> and <span class="math inline">\(b^{\prime} = b/2\)</span>. Thus estimating this relation directly will lead to a problem to uniquely identify the coefficients. To circumvent this problem, we just have to fix one of the coefficient, this will ensure that we uniquely identify them.</p>
<p>Let’s generate this relation:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the class of each observation</span>
<span class="va">id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">20</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">base</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="va">id</span>
<span class="co"># the vector of fixed-effects</span>
<span class="va">gamma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span>
<span class="co"># the new vector z_bis</span>
<span class="va">z_bis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">gamma</span><span class="op">[</span><span class="va">id</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">base</span><span class="op">$</span><span class="va">z_bis</span> <span class="op">=</span> <span class="va">z_bis</span></code></pre></div>
<p>Now we estimate it with the fixed-effects while fixing one of the coefficients (we fix <span class="math inline">\(a\)</span> to its true value but it could be any value):</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we add the fixed-effect in the formula</span>
<span class="va">result_NL_fe</span> <span class="op">=</span> <span class="fu"><a href="../reference/feNmlm.html">feNmlm</a></span><span class="op">(</span><span class="va">z_bis</span><span class="op">~</span><span class="fl">0</span><span class="op">|</span><span class="va">id</span>, <span class="va">base</span>, NL.fml <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">b</span><span class="op">*</span><span class="va">y</span><span class="op">)</span>, NL.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="co"># The coef should be around 3</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">result_NL_fe</span><span class="op">)</span>
<span class="co">#&gt;        b </span>
<span class="co">#&gt; 3.024891</span>
<span class="co"># the gamma and the exponential of the fixed-effects should be similar</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">gamma</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">result_NL_fe</span><span class="op">)</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;              1         2         3         4           5        6          7</span>
<span class="co">#&gt; gamma 2.679535 0.1707382 0.7294981 0.6375940 0.002920490 2.202472 0.08203791</span>
<span class="co">#&gt;       2.670332 0.1831774 0.7519754 0.6240016 0.008805172 2.220800 0.08548657</span>
<span class="co">#&gt;              8        9       10       11        12       13        14</span>
<span class="co">#&gt; gamma 1.501218 1.262652 1.515043 1.681641 0.1949462 1.095457 1.0023382</span>
<span class="co">#&gt;       1.454965 1.276599 1.493300 1.705419 0.1975139 1.104186 0.9971681</span>
<span class="co">#&gt;              15       16        17        18        19        20</span>
<span class="co">#&gt; gamma 0.3743722 2.606235 0.5238710 0.1428949 0.4871731 0.1550584</span>
<span class="co">#&gt;       0.3896577 2.609243 0.5372464 0.1433603 0.4910665 0.1629123</span></code></pre></div>
<p>As we can see, we obtain the “right” estimates.</p>
</div>
</div>
<div id="multi-threading" class="section level2">
<h2 class="hasAnchor">
<a href="#multi-threading" class="anchor"></a>Multi-threading</h2>
<p>The package <code>fixest</code> integrates multi-platform parallelism to hasten the estimation process. By default it makes use of 50% of all available threads. To change the number of threads used, just use the argument <code>nthreads</code>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sample of results:</span>
<span class="co"># 1 nthreads: 3.13s</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span><span class="op">|</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">+</span><span class="va">Product</span><span class="op">+</span><span class="va">Year</span>, <span class="va">trade</span>, nthreads <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co"># 2 nthreads: 1.82s</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span><span class="op">|</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">+</span><span class="va">Product</span><span class="op">+</span><span class="va">Year</span>, <span class="va">trade</span>, nthreads <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co"># 4 nthreads: 1.17s</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span><span class="op">|</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">+</span><span class="va">Product</span><span class="op">+</span><span class="va">Year</span>, <span class="va">trade</span>, nthreads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As you can see, the efficiency of increasing the number of threads is not 1 to 1. Two threads do not divide the computing time by 2, nor four threads by 4. However it still reduces significantly the computing time, which might be valuable for large sample estimations.</p>
<p>You can permanently set the number of threads used by <code>fixest</code> using <code><a href="../reference/setFixest_nthreads.html">setFixest_nthreads(nthreads)</a></code>.</p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Since the <span class="math inline">\(\gamma\)</span> are parameters, I omit to put them in logarithmic form.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
