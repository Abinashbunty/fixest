<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>On standard-errors • fixest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="On standard-errors">
<meta property="og:description" content="fixest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fixest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/exporting_tables.html">Exporting estimation tables</a>
    </li>
    <li>
      <a href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short introduction</a>
    </li>
    <li>
      <a href="../articles/multiple_estimations.html">Multiple estimations</a>
    </li>
    <li>
      <a href="../articles/standard_errors.html">On standard-errors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrberge/fixest/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="standard_errors_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>On standard-errors</h1>
                        <h4 class="author">Laurent Berge</h4>
            
            <h4 class="date">2021-04-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/master/vignettes/standard_errors.Rmd"><code>vignettes/standard_errors.Rmd</code></a></small>
      <div class="hidden name"><code>standard_errors.Rmd</code></div>

    </div>

    
    
<p>It is an euphemism to say that standard-errors are a critical element of your estimations: literally your paper’s results depend on them. It is therefore unfortunate that no conventional “best” way exists to compute them. Multiple definitions can create confusion and the purpose of this document is to lay bare the fiddly details of standard-error computation in this package.</p>
<p>The first part describes how standard-errors are computed in <code>fixest</code>’s estimations. Please note that here I don’t discuss the <em>why</em>, but only the <em>how</em>. For a thorough introduction to the topic, see the excellent paper by <a href="https://cran.r-project.org/package=sandwich/vignettes/sandwich-CL.pdf">Zeileis, Koll and Graham (2020)</a>. The second part illustrates how to replicate some standard-errors obtained from other estimation methods with <code>fixest</code>.</p>
<p>This document applies to <code>fixest</code> version 0.8.0 or higher.</p>
<div id="how-standard-errors-are-computed-in-fixest" class="section level2">
<h2 class="hasAnchor">
<a href="#how-standard-errors-are-computed-in-fixest" class="anchor"></a>How standard-errors are computed in <code>fixest</code>
</h2>
<p>There are two components defining the standard-errors in <code>fixest</code>. The main type of standard-error is given by the argument <code>se</code>, the small sample correction is defined by the argument <code>dof</code> (<em>degree of freedom</em>).</p>
<p>Here’s an example, the explanations follow in the next two sections:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span>
<span class="co"># OLS estimation</span>
<span class="va">gravity</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Euros</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span>
<span class="co"># Two-way clustered SEs</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity</span>, se <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; OLS estimation, Dep. Var.: log(Euros)
#&gt; Observations: 38,325 
#&gt; Fixed-effects: Destination: 15,  Origin: 15,  Product: 20,  Year: 10
#&gt; Standard-errors: Two-way (Destination &amp; Origin) 
#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; log(dist_km)  -2.1699   0.171367 -12.662 4.68e-09 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; RMSE: 1.7434     Adj. R2: 0.705139
#&gt;                Within R2: 0.219322</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Two-way clustered SEs, without DOF correction</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gravity</span>, se <span class="op">=</span> <span class="st">"twoway"</span>, dof <span class="op">=</span> <span class="fu"><a href="../reference/dof.html">dof</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; OLS estimation, Dep. Var.: log(Euros)
#&gt; Observations: 38,325 
#&gt; Fixed-effects: Destination: 15,  Origin: 15,  Product: 20,  Year: 10
#&gt; Standard-errors: Two-way (Destination &amp; Origin) 
#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; log(dist_km)  -2.1699   0.165494 -13.112 2.98e-09 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; RMSE: 1.7434     Adj. R2: 0.705139
#&gt;                Within R2: 0.219322</code></pre>
<div id="the-argument-se" class="section level3">
<h3 class="hasAnchor">
<a href="#the-argument-se" class="anchor"></a>The argument <code>se</code>
</h3>
<p>The argument <code>se</code> can be equal to either: <code>"standard"</code>, <code>"hetero"</code>, <code>"cluster"</code>, <code>"twoway"</code>, or <code>"threeway"</code>.</p>
<p>If <code>se = "standard"</code>, then the standard-errors are based on the assumption that the errors are all independent and generated with the same law (in particular, same variance). If <code>se = "hetero"</code>, this corresponds to the classic hereoskedasticity-robust standard-errors (White correction), where it is assumed that the errors are independent but the variance of their generative law may vary. If <code>se = "cluster"</code>, then arbitrary correlation of the errors within clusters is accounted for. Same for <code>se = "twoway"</code> (resp. <code>"threeway"</code>): arbitrary correlation within each of the two (resp. three) clusters is accounted for.</p>
</div>
<div id="the-argument-dof" class="section level3">
<h3 class="hasAnchor">
<a href="#the-argument-dof" class="anchor"></a>The argument <code>dof</code>
</h3>
<p>The type of small sample correction applied is defined by the argument <code>dof</code> which accepts only objects produced by the function <code>dof</code>. The main arguments of this function are <code>adj</code>, <code>fixef.K</code> and <code>cluster.adj</code>. I detail each of them below.</p>
<p>Say you have <span class="math inline">\(\tilde{V}\)</span> the variance-covariance matrix (henceforth VCOV) before any small sample adjustment. Argument <code>adj</code> can be equal to <code>TRUE</code> or <code>FALSE</code>, leading to the following adjustment:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/adj.png?raw=true"></p>
<p>When the estimation contains fixed-effects, the value of <span class="math inline">\(K\)</span> in the previous adjustment can be determined in different ways, governed by the argument <code>fixef.K</code>. To illustrate how <span class="math inline">\(K\)</span> is computed, let’s use an example with individual (variable <code>id</code>) and time fixed-effect and with clustered standard-errors. The structure of the 10 observations data is:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/sample_data.png?raw=true"></p>
<p>The standard-errors are clustered with respect to the <code>cluster</code> variable, further we can see that the variable <code>id</code> is nested within the <code>cluster</code> variable (i.e. each value of <code>id</code> “belongs” to only one value of <code>cluster</code>; e.g. <code>id</code> could represent US counties and <code>cluster</code> US states).</p>
<p>The argument <code>fixef.K</code> can be equal to either <code>"none"</code>, <code>"nested"</code> or <code>"full"</code>. Then <span class="math inline">\(K\)</span> will be computed as follows:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/K_computation.png?raw=true"></p>
<p>Where <span class="math inline">\(K_{vars}\)</span> is the number of estimated coefficients associated to the variables. <code>fixef.K="none"</code> discards all fixed-effects coefficients. <code>fixef.K="nested"</code> discards all coefficients that are nested (here the 5 coefficients from <code>id</code>). Finally <code>fixef.K="full"</code> accounts for all fixed-effects coefficients (here 6: equal to 5 from <code>id</code>, plus 2 from <code>time</code>, minus one used as a reference [otherwise collinearity arise]). Note that if <code>fixef.K="nested"</code> and the standard-errors are <em>not</em> clustered, this is equivalent to using <code>fixef.K="full".</code></p>
<p>The last argument of <code>dof</code> is <code>cluster.adj</code>. This argument is only relevant when the standard-errors are clustered. Let <span class="math inline">\(M\)</span> be the sandwich estimator of the VCOV without adjustment. Then for one-way clustered standard errors:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/cluster_adj_one_way.png?raw=true"></p>
<p>With <span class="math inline">\(G\)</span> the number of unique elements of the cluster variable (in the previous example <span class="math inline">\(G=2\)</span> for <code>cluster</code>).</p>
<p>The effect of the adjusment for two-way clustered standard-errors is as follows:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/cluster_adj_two_way.png?raw=true"></p>
<p>Using the data from the previous example, here the standard-errors are clustered by <code>id</code> and <code>time</code>, leading to <span class="math inline">\(G_{id}=5\)</span>, <span class="math inline">\(G_{time}=2\)</span>, and <span class="math inline">\(G_{id,time}=10\)</span>.</p>
<div id="yet-more-details" class="section level4">
<h4 class="hasAnchor">
<a href="#yet-more-details" class="anchor"></a>Yet more details</h4>
<p>You’re already fed up about about these details? I’m sorry but there’s more, so far you’ve only seen the main arguments! I now come to detail three more elements: <code>fixef.force_exact</code>, <code>cluster.df</code> and <code>t.df</code>.</p>
<p>Argument <code>fixef.force_exact</code> is only relevant when there are two or more fixed-effects. By default all the fixed-effects coefficients are accounted for when computing the degrees of freedom. In general this is fine, but in some situations it may overestimate the number of estimated coefficients. Why? Because some of the fixed-effects may be collinear, the effective number of coefficients being lower. Let’s illustrate that with an example. Consider the following set of fixed-effects:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/exact_collinearity.png?raw=true"></p>
<p>There are 6 different values of <code>id</code> and 4 different values of <code>time</code>. By default, 9 coefficients are used to compute the degrees of freedom (6 plus 4 minus one reference). But we can see here that the “effective” number of coefficients is equal to 8: two coefficients should be removed to avoid collinearity issues (any one from each color set). If you use <code>fixef.force_exact=TRUE</code>, then the function <code>fixef</code> is first run to determine the number of free coefficients in the fixed-effects, this number is then used to compute the degree of freedom.</p>
<p>Argument <code>cluster.df</code> is only relevant when you apply two-way clustering (or higher). It can have two values: either <code>"conventional"</code>, or <code>"min"</code> (the default). This affects the adjustments for each clustered matrix. The <code>"conventional"</code> way to make the adjustment has already been described in the previous equation. If <code>cluster.df="min"</code> (again, the default), and for two-way clustered standard errors, the adjusment becomes:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/cluster_df_min.png?raw=true"></p>
<p>Now instead of having a specific adjustment for each matrix, there is only one adjustment of <span class="math inline">\(G_{min}/(G_{min}-1)\)</span> where <span class="math inline">\(G_{min}\)</span> is the minimum cluster size (here <span class="math inline">\(G_{min}=\min(G_{id},G_{time})\)</span>).</p>
<p>Argument <code>t.df</code> is only relevant when standard-errors are clustered. It affects the way the <em>p-value</em> is computed. It can be equal to: either <code>"conventional"</code>, or <code>"min"</code> (the default). By default, when standard-errors are clustered, the degrees of freedom used in the Student t distribution is equal to the minimum cluster size (among all clusters used to cluster the VCOV). If <code>t.df="conventional"</code>, the degrees of freedom used to find the p-value from the Student t distribution is equal to the number of observations minus the number of estimated coefficients.</p>
</div>
</div>
</div>
<div id="replicating-standard-errors-from-other-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#replicating-standard-errors-from-other-methods" class="anchor"></a>Replicating standard-errors from other methods</h2>
<p>This section illustrates how the results from <code>fixest</code> compares with the ones from other methods. It also shows how to replicate the latter from <code>fixest</code>.</p>
<p>First, let’s generate some data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data generation</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
<span class="va">N</span> <span class="op">=</span> <span class="fl">20</span> ; <span class="va">n_id</span> <span class="op">=</span> <span class="va">N</span><span class="op">/</span><span class="fl">5</span>; <span class="va">n_time</span> <span class="op">=</span> <span class="va">N</span><span class="op">/</span><span class="va">n_id</span>
<span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_id</span>, <span class="va">n_time</span><span class="op">)</span>, 
                  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_time</span>, each <span class="op">=</span> <span class="va">n_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here are some comparisons when the estimation doesn’t contain fixed-effects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://sandwich.R-Forge.R-project.org/">sandwich</a></span><span class="op">)</span>

<span class="co"># Estimations</span>
<span class="va">res_lm</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">base</span><span class="op">)</span>
<span class="va">res_feols</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">base</span><span class="op">)</span>

<span class="co"># Same standard-errors</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">res_lm</span><span class="op">)</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">res_feols</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;      (Intercept)         x
#&gt; [1,]     0.23693 0.3347682
#&gt; [2,]     0.23693 0.3347682</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Heteroskedasticity-robust covariance</span>
<span class="va">se_lm_hc</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://sandwich.R-Forge.R-project.org//reference/vcovHC.html">vcovHC</a></span><span class="op">(</span><span class="va">res_lm</span>, type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">se_feols_hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">res_feols</span>, se <span class="op">=</span> <span class="st">"hetero"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">se_lm_hc</span>, <span class="va">se_feols_hc</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;             (Intercept)        x
#&gt; se_lm_hc      0.2341859 0.215208
#&gt; se_feols_hc   0.2341859 0.215208</code></pre>
<p>Note that Stata’s <code>reg y x, robust</code> also leads to similar results (same SEs, same p-values).</p>
<p>The most important differences arise in the presence of fixed-effects. Let’s first compare “standard” standard-errors between <code>lm</code> and <code>plm</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=plm">plm</a></span><span class="op">)</span>

<span class="co"># Estimations</span>
<span class="va">est_lm</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, <span class="va">base</span><span class="op">)</span>
<span class="va">est_plm</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/plm.html">plm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, <span class="va">base</span>, index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"time"</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"within"</span><span class="op">)</span>
<span class="va">est_feols</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">time</span>, <span class="va">base</span><span class="op">)</span>

<span class="co">#</span>
<span class="co"># "Standard" standard-errors</span>
<span class="co">#</span>

<span class="co"># By default fixest clusters the SEs when FEs are present,</span>
<span class="co">#  so we need to ask for standard SEs explicitly.</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_lm</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_plm</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, se <span class="op">=</span> <span class="st">"standard"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;              x
#&gt; [1,] 0.3956029
#&gt; [2,] 0.3956029
#&gt; [3,] 0.3956029</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># p-values:</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_lm</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_plm</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_feols</span>, se <span class="op">=</span> <span class="st">"standard"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;              x
#&gt; [1,] 0.3638934
#&gt; [2,] 0.3638934
#&gt; [3,] 0.3638934</code></pre>
<p>The standard-errors and p-values are identical, note that this is also the case for Stata’s <code>xtreg</code>.</p>
<p>Now for clustered SEs:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Clustered by id</span>
<span class="va">se_lm_id</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://sandwich.R-Forge.R-project.org//reference/vcovCL.html">vcovCL</a></span><span class="op">(</span><span class="va">est_lm</span>, cluster <span class="op">=</span> <span class="va">base</span><span class="op">$</span><span class="va">id</span>, type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span>, <span class="st">"x"</span><span class="op">]</span><span class="op">)</span>
<span class="va">se_plm_id</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/re-export_functions.html">vcovHC</a></span><span class="op">(</span><span class="va">est_plm</span>, cluster <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span>, <span class="st">"x"</span><span class="op">]</span><span class="op">)</span>
<span class="va">se_stata_id</span> <span class="op">=</span> <span class="fl">0.165385</span>      <span class="co"># vce(cluster id)</span>
<span class="va">se_feols_id</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span><span class="op">)</span> <span class="co"># By default: clustered according to id</span>

<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">se_lm_id</span>, <span class="va">se_plm_id</span>, <span class="va">se_stata_id</span>, <span class="va">se_feols_id</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;                     x
#&gt; se_lm_id    0.1865794
#&gt; se_plm_id   0.1229459
#&gt; se_stata_id 0.1653850
#&gt; se_feols_id 0.1653850</code></pre>
<p>As we can see, there are three different versions of the standard-errors, <code>feols</code> being identical to Stata’s <code>xtreg</code> clustered SEs. By default, the <em>p-value</em> is also identical to the one from Stata (from <code>fixest</code> version 0.7.0 onwards).</p>
<p>Now let’s see how to replicate the standard-errors from <code>lm</code> and <code>plm</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># How to get the lm version</span>
<span class="va">se_feols_id_lm</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, dof <span class="op">=</span> <span class="fu"><a href="../reference/dof.html">dof</a></span><span class="op">(</span>fixef.K <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">se_lm_id</span>, <span class="va">se_feols_id_lm</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;                        x
#&gt; se_lm_id       0.1865794
#&gt; se_feols_id_lm 0.1865794</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># How to get the plm version</span>
<span class="va">se_feols_id_plm</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, dof <span class="op">=</span> <span class="fu"><a href="../reference/dof.html">dof</a></span><span class="op">(</span>fixef.K <span class="op">=</span> <span class="st">"none"</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">se_plm_id</span>, <span class="va">se_feols_id_plm</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;                         x
#&gt; se_plm_id       0.1229459
#&gt; se_feols_id_plm 0.1229459</code></pre>
<p>As we can see, the type of small sample correction we choose can have a non-negligible impact on the standard-error.</p>
<div id="other-multiple-fixed-effects-methods" class="section level4">
<h4 class="hasAnchor">
<a href="#other-multiple-fixed-effects-methods" class="anchor"></a>Other multiple fixed-effects methods</h4>
<p>Now a specific comparison with <code>lfe</code> (version 2.8-5.1) and Stata’s <code>reghdfe</code> which are popular tools to estimate econometric models with multiple fixed-effects.</p>
<p>From <code>fixest</code> version 0.7.0 onwards, the standard-errors and p-values are computed similarly to <code>reghdfe</code>, for both clustered and multiway clustered standard errors. So the comparison here focuses on <code>lfe</code>.</p>
<p>Here are the differences and similarities with <code>lfe</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sgaure/lfe">lfe</a></span><span class="op">)</span>

<span class="co"># lfe: clustered by id</span>
<span class="va">est_lfe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">time</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base</span><span class="op">)</span>
<span class="va">se_lfe_id</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_lfe</span><span class="op">)</span>

<span class="co"># The two are different, and it cannot be directly replicated by feols</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">se_lfe_id</span>, <span class="va">se_feols_id</span><span class="op">)</span>
<span class="co">#&gt;                     x</span>
<span class="co">#&gt; se_lfe_id   0.1458559</span>
<span class="co">#&gt; se_feols_id 0.1653850</span>

<span class="co"># You have to provide a custom VCOV to replicate lfe's VCOV</span>
<span class="va">my_vcov</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">est_feols</span>, dof <span class="op">=</span> <span class="fu"><a href="../reference/dof.html">dof</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, .vcov <span class="op">=</span> <span class="va">my_vcov</span> <span class="op">*</span> <span class="fl">19</span><span class="op">/</span><span class="fl">18</span><span class="op">)</span> <span class="co"># Note that there are 20 observations</span>
<span class="co">#&gt;         x </span>
<span class="co">#&gt; 0.1458559</span>

<span class="co"># Differently from feols, the SEs in lfe are different if time is not a FE:</span>
<span class="co"># =&gt; now SEs are identical.</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span>,
      <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;             x</span>
<span class="co">#&gt; [1,] 0.165385</span>
<span class="co">#&gt; [2,] 0.165385</span>

<span class="co"># Now with two-way clustered standard-errors</span>
<span class="va">est_lfe_2way</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html">felm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">time</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">time</span>, <span class="va">base</span><span class="op">)</span>
<span class="va">se_lfe_2way</span>  <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_lfe_2way</span><span class="op">)</span>
<span class="va">se_feols_2way</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, se <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">se_lfe_2way</span>, <span class="va">se_feols_2way</span><span class="op">)</span>
<span class="co">#&gt;                       x</span>
<span class="co">#&gt; se_lfe_2way   0.3268584</span>
<span class="co">#&gt; se_feols_2way 0.3080378</span>

<span class="co"># To obtain the same SEs, use cluster.df = "conventional"</span>
<span class="va">sum_feols_2way_conv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">est_feols</span>, se <span class="op">=</span> <span class="st">"twoway"</span>, dof <span class="op">=</span> <span class="fu"><a href="../reference/dof.html">dof</a></span><span class="op">(</span>cluster.df <span class="op">=</span> <span class="st">"conv"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">se_lfe_2way</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">sum_feols_2way_conv</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                     x</span>
<span class="co">#&gt; se_lfe_2way 0.3268584</span>
<span class="co">#&gt;             0.3268584</span>

<span class="co"># We also obtain the same p-values</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_lfe_2way</span><span class="op">)</span>, <span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">sum_feols_2way_conv</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;              x</span>
<span class="co">#&gt; [1,] 0.3347851</span>
<span class="co">#&gt; [2,] 0.3347851</span></code></pre></div>
<p>As we can see, there is only slight differences with <code>lfe</code> when computing clustered standard-errors. For multiway clustered standard-errors, it is easy to replicate the way <code>lfe</code> computes them.</p>
</div>
<div id="defining-how-to-compute-the-standard-errors-once-and-for-all" class="section level4">
<h4 class="hasAnchor">
<a href="#defining-how-to-compute-the-standard-errors-once-and-for-all" class="anchor"></a>Defining how to compute the standard-errors once and for all</h4>
<p>Once you’ve found the preferred way to compute the standard-errors for your current project, you can set it permanently using the functions <code><a href="../reference/dof.html">setFixest_dof()</a></code> and <code><a href="../reference/setFixest_se.html">setFixest_se()</a></code>.</p>
<p>For example, if you want to remove the small sample adjustment, just use:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dof.html">setFixest_dof</a></span><span class="op">(</span><span class="fu"><a href="../reference/dof.html">dof</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>By default, the standard-errors are clustered in the presence of fixed-effects. You can change this behavior with, e.g.:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/setFixest_se.html">setFixest_se</a></span><span class="op">(</span>no_FE <span class="op">=</span> <span class="st">"standard"</span>, one_FE <span class="op">=</span> <span class="st">"standard"</span>, two_FE <span class="op">=</span> <span class="st">"standard"</span><span class="op">)</span></code></pre></div>
<p>which changes the way the default standard-errors are computed when the estimation contains no fixed-effects, one fixed-effect, or two or more fixed-effects.</p>
</div>
</div>
<div id="changelog" class="section level2">
<h2 class="hasAnchor">
<a href="#changelog" class="anchor"></a>Changelog</h2>
<ul>
<li><p>Version 0.8.0. Evaluation of the chunks related to <code>lfe</code> have been removed since its archival on the CRAN. Hard values from the last CRAN version are maintained.</p></li>
<li>
<p>Version 0.7.0 introduces the following important modifications:</p>
<ul>
<li><p>To increase clarity, <code>se = "white"</code> becomes <code>se = "hetero"</code>. Retro-compatibility is ensured.</p></li>
<li><p>The default values for computing clustered standard-errors become similar to <code>reghdfe</code> to avoid cross-software confusion. That is, now by default <code>cluster.df = "min"</code> and <code>t.df = "min"</code> (whereas in the previous version it was <code>cluster.df = "conventional"</code> and <code>t.df = "conventional"</code>).</p></li>
</ul>
</li>
</ul>
</div>
<div id="references-acknowledgments" class="section level2">
<h2 class="hasAnchor">
<a href="#references-acknowledgments" class="anchor"></a>References &amp; acknowledgments</h2>
<p>I wish to thank Karl Dunkle Werner, Grant McDermott and Ivo Welch for raising the issue and for helpful discussions. Any error is of course my own.</p>
<p>Zeileis A, Koll S, Graham N (2020). “<a href="https://cran.r-project.org/package=sandwich/vignettes/sandwich-CL.pdf">Various Versatile Variances: An Object-Oriented Implementation of Clustered Covariances in R.</a>” Journal of Statistical Software, 95(1), 1–36.</p>
<p>MacKinnon, JG, White, H (1985). “Some heteroskedasticity-consistent covariance matrix estimators with improved finite sample properties” Journal of Econometrics, 29(3), 305–325.</p>
<p>Kauermann G, Carroll RJ (2001). “<a href="https://www.tandfonline.com/doi/abs/10.1198/016214501753382309">A Note on the Efficiency of Sandwich Covariance Matrix Estimation</a>”, Journal of the American Statistical Association, 96(456), 1387–1396.</p>
<p>Cameron AC, Gelbach JB, Miller DL (2011). “<a href="https://www.nber.org/papers/t0327">Robust Inference with Multiway Clustering</a>”, Journal of Business &amp; Ecomomic Statistics, 29(2), 238–249.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
